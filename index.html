<html>
  <head>
    <script type='text/javascript' src='js/jquery.js'></script>
    <script type='text/javascript' src='https://www.google.com/jsapi'></script>
    <script type='text/javascript'>
      google.load('visualization', '1', {'packages': ['geochart']});
      google.setOnLoadCallback(function() { drawMarkersMap("2014", $('#dataset').val() + ".json"); });

      function drawMarkersMap(year, dataset) {

        var json = (function() {
          var json = null;
          $.ajax({
              'async': false,
              'global': false,
              'url': "dataset/" + dataset,
              'dataType': "json",
              'success': function (data) {
                  json = data;
              }
          });
            return json;
        })();

        /* Configurator */
        var country = "Country";

        var result = [];

        json.forEach( function(entry) {
          var n = 0;
          if (entry[year] != "") {
            n = entry[year];
          }

          result.push([entry[country], n]);
        });

        var data = new google.visualization.DataTable();
        data.addColumn('string', 'Country');
        data.addColumn('number', 'Emission');
        data.addRows(result);

        var options = {
          colorAxis: {colors: ['green', 'blue']}
        };

        var chart = new google.visualization.GeoChart(document.getElementById('chart_div'));
        chart.draw(data, options);
      };
    </script>
  </head>
  <body>
    <div id="chart_div" style="width: 900px; height: 500px;"></div>

    <form>
      <input type="range" id="year_slider" name="year_slider" min="1960" max="2014" value="2014" oninput="this.form.year_showing.value=this.value; drawMarkersMap($('#year_slider').val(), $('#dataset').val() + '.json');" />
      <input type="number" name="year_showing" min="1960" max="2014" value="2014" oninput="this.form.year_slider.value=this.value; drawMarkersMap($('#year_slider').val(), $('#dataset').val() + '.json');" />

      <select id="dataset" onchange="drawMarkersMap($('#year_slider').val(), $('#dataset').val() + '.json');">
        <option value="CO2EmissionTransportation">CO2 Emmision from Transportation</option>
        <option value="ElectricityByRenewable">Electricity By Renewable</option>
      </select>
    </form>

  </body>
    
</html>